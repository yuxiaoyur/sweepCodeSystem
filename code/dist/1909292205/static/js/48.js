webpackJsonp([48,98],{"1eUV":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s={data:function(){return{dataForm:{gjc:"",date:""},dataList:[],pageIndex:1,pageSize:10,totalPage:0,dataListLoading:!1,dataListSelections:[],permission:[],permissionVisible:{add:!1,update:!1,delete:!1},addOrUpdateVisible:!1}},components:{AddOrUpdate:a("93ad").default},activated:function(){this.getDataList()},mounted:function(){this.getPermission()},methods:{getPermission:function(){var t=this;this.$http({url:this.$http.adornUrl("/sys/menuPermission"),method:"get",params:this.$http.adornParams({menuId:this.$route.meta.menuId})}).then(function(e){var a=e.data;t.permission=a;for(var s=0;s<a.length;s++)switch(a[s].split(":")[1]){case"add":t.permissionVisible.add=!0;break;case"update":t.permissionVisible.update=!0;break;case"delete":t.permissionVisible.delete=!0}})},hasPermission:function(t){switch(t){case"add":return this.permissionVisible.add;case"update":return this.permissionVisible.update;case"delete":return this.permissionVisible.delete;default:return!1}},getDataList:function(){var t=this;this.dataListLoading=!0,this.$http({url:this.$http.adornUrl("/mssq/jjsq"),method:"get",params:this.$http.adornParams({page:this.pageIndex,limit:this.pageSize,gjc:this.dataForm.gjc,date:this.dataForm.date})}).then(function(e){var a=e.data;a&&a.successful?(t.dataList=a.data.list,t.totalPage=a.data.total,t.dataListLoading=!1):(console.log("ERROR",a),t.$message.error("操作失败"))})},sizeChangeHandle:function(t){this.pageSize=t,this.pageIndex=1,this.getDataList()},currentChangeHandle:function(t){this.pageIndex=t,this.getDataList()},selectionChangeHandle:function(t){this.dataListSelections=t},addOrUpdateHandle:function(t){var e=this;this.addOrUpdateVisible=!0,this.$nextTick(function(){e.$refs.addOrUpdate.init(t)})},deleteHandle:function(t){var e=this,a=t?[t]:this.dataListSelections.map(function(t){return t.id});null!=a&&""!=a?this.$confirm("确定进行["+(t?"删除":"批量删除")+"]操作?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$http({url:e.$http.adornUrl("/mssq/jjsq/remove"),method:"post",params:e.$http.adornParams({id:a.join(",")},!1)}).then(function(t){var a=t.data;a&&a.successful?e.$message({message:"操作成功",type:"success",duration:1500,onClose:function(){e.getDataList()}}):e.$message.error(a.message)})}).catch(function(){}):this.$message.error("请选择要删除的数据")}}},l={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"mod-mssq-rcjl"},[a("el-form",{attrs:{inline:!0,model:t.dataForm},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;t.getDataList()}}},[a("el-form-item",[a("el-input",{attrs:{placeholder:"关键词(诉求主题、描述)",clearable:""},model:{value:t.dataForm.gjc,callback:function(e){t.$set(t.dataForm,"gjc",e)},expression:"dataForm.gjc"}})],1),t._v(" "),a("el-form-item",[a("el-input",{attrs:{placeholder:"受理时间(yyyy-MM-dd)",clearable:""},model:{value:t.dataForm.date,callback:function(e){t.$set(t.dataForm,"date",e)},expression:"dataForm.date"}})],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.getDataList()}}},[t._v("查询")]),t._v(" "),t.hasPermission("add")?a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.addOrUpdateHandle()}}},[t._v("新增")]):t._e(),t._v(" "),t.hasPermission("delete")?a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.deleteHandle()}}},[t._v("批量删除")]):t._e()],1)],1),t._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.dataListLoading,expression:"dataListLoading"}],staticStyle:{width:"100%"},attrs:{data:t.dataList,border:""},on:{"selection-change":t.selectionChangeHandle}},[a("el-table-column",{attrs:{type:"selection","header-align":"center",align:"center",width:"50"}}),t._v(" "),a("el-table-column",{attrs:{prop:"slsj","header-align":"center",align:"center",width:"100",label:"受理时间"}}),t._v(" "),a("el-table-column",{attrs:{prop:"sqzt","header-align":"center",align:"center",width:"120",label:"诉求主题"}}),t._v(" "),a("el-table-column",{attrs:{prop:"sqms","header-align":"center",align:"left",width:"200",label:"诉求描述"}}),t._v(" "),a("el-table-column",{attrs:{prop:"zbdw","header-align":"center",align:"center",width:"100",label:"转办单位"}}),t._v(" "),a("el-table-column",{attrs:{prop:"blqk","header-align":"center",align:"left",width:"200",label:"办理情况"}}),t._v(" "),a("el-table-column",{attrs:{prop:"area","header-align":"center",align:"center",width:"80",label:"区域"}}),t._v(" "),a("el-table-column",{attrs:{prop:"nrfl","header-align":"center",align:"center",width:"100",label:"内容分类"}}),t._v(" "),a("el-table-column",{attrs:{prop:"address","header-align":"center",align:"center",label:"地址"}}),t._v(" "),a("el-table-column",{attrs:{"header-align":"center",align:"center",width:"100",label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[t.hasPermission("update")?a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){t.addOrUpdateHandle(e.row.id)}}},[t._v("修改")]):t._e(),t._v(" "),t.hasPermission("delete")?a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){t.deleteHandle(e.row.id)}}},[t._v("删除")]):t._e()]}}])})],1),t._v(" "),a("el-pagination",{attrs:{"current-page":t.pageIndex,"page-sizes":[10,20,50,100],"page-size":t.pageSize,total:t.totalPage,layout:"total, sizes, prev, pager, next, jumper"},on:{"size-change":t.sizeChangeHandle,"current-change":t.currentChangeHandle}}),t._v(" "),t.addOrUpdateVisible?a("add-or-update",{ref:"addOrUpdate",on:{refreshDataList:t.getDataList}}):t._e()],1)},staticRenderFns:[]},r=a("46Yf")(s,l,!1,null,null,null);e.default=r.exports},"93ad":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("E4LH"),l={data:function(){var t=function(t,e,a){Object(s.e)(e)?a(new Error("请不要输入英文逗号")):a()};return{visible:!1,dataForm:{id:0,slsj:"",sqzt:"",sqms:"",zbdw:"",blqk:"",nrfl:"",area:"",address:"",path:"",bllc:[{lcmc:"",lcsj:"",lcms:""}]},dataRule:{slsj:[{required:!0,message:"受理时间不能为空",trigger:"blur"},{validator:function(t,e,a){Object(s.a)(e)?a():a(new Error("时间格式错误"))},trigger:"blur"}]},bllcRules:{lcmc:[{required:!0,message:"流程名称不能为空",trigger:"blur"},{max:8,message:"长度不能超过8个字",trigger:"blur"},{validator:t,trigger:"blur"}],lcsj:[{validator:t,trigger:"blur"}],lcms:[{validator:t,trigger:"blur"}]},fileUrl:this.$http.adornUrl("/mssq/jjcl/upload")}},methods:{init:function(t){var e=this;this.visible=!0,this.$nextTick(function(){e.dataForm.bllc=[{lcmc:"",lcsj:"",lcms:""}],e.$refs.dataForm.resetFields(),e.$refs.audio.src="",e.dataForm.id=t,e.dataForm.id&&e.$http({url:e.$http.adornUrl("/mssq/jjsq/detail?id="+e.dataForm.id),method:"get"}).then(function(t){var a=t.data;a&&a.successful?(e.dataForm.slsj=a.data.slsj,e.dataForm.sqzt=a.data.sqzt,e.dataForm.sqms=a.data.sqms,e.dataForm.zbdw=a.data.zbdw,e.dataForm.blqk=a.data.blqk,e.dataForm.nrfl=a.data.nrfl,e.dataForm.area=a.data.area,e.dataForm.address=a.data.address,e.dataForm.path=a.data.path,e.$refs.audio.src=a.data.play,e.dataForm.bllc=a.data.bllc):(console.log("ERROR",a),e.$message.error("操作失败"))})})},dataFormSubmit:function(){for(var t=this,e=new Array,a=new Array,s=new Array,l=this.dataForm.bllc,r=0;r<l.length;r++)e.push(l[r].lcmc.length>0?l[r].lcmc:"--"),a.push(l[r].lcsj.length>0?l[r].lcsj:"--"),s.push(l[r].lcms.length>0?l[r].lcms:"--");this.$refs.dataForm.validate(function(l){l&&t.$http({url:t.$http.adornUrl("/mssq/jjsq/"+(t.dataForm.id?"update":"save")),method:"post",params:t.$http.adornParams({id:t.dataForm.id||void 0,slsj:t.dataForm.slsj,sqzt:t.dataForm.sqzt,sqms:t.dataForm.sqms,zbdw:t.dataForm.zbdw,blqk:t.dataForm.blqk,nrfl:t.dataForm.nrfl,area:t.dataForm.area,address:t.dataForm.address,path:t.dataForm.path})}).then(function(l){var r=l.data;r&&r.successful?t.$http({url:t.$http.adornUrl("/mssq/jjsq/bllc"),method:"post",params:t.$http.adornParams({id:r.data,lcmc:e.toString(),lcsj:a.toString(),lcms:s.toString()})}).then(function(e){var a=e.data;a&&a.successful?t.$message({message:"操作成功",type:"success",duration:1500,onClose:function(){t.visible=!1,t.$emit("refreshDataList")}}):t.$message.error(a.message)}):t.$message.error(r.message)})})},submitUpload:function(){this.$refs.upload.submit()},beforeAvatarUpload:function(t){var e=t.name.split(".");return"wav"===e[1].toLowerCase()||"mp3"===e[1].toLowerCase()?t.size/1024/1024>20?(this.$message.error("上传文件大小不能超过20M!"),!1):t:(this.$message.error("上传文件只能是 wav/mp3 格式!"),!1)},handleRemove:function(t){},handlePreview:function(t){},handleSuccess:function(t,e){t.flag?(this.dataForm.path=t.path,this.$refs.upload.clearFiles(),this.$refs.audio.src=t.play,this.$message({message:"上传成功！",type:"success"})):this.$message({message:"上传失败！",type:"error"})},closeDialog:function(){this.$refs.audio.src="",this.dataForm.bllc=[{lcmc:"",lcsj:"",lcms:""}],this.$refs.upload.clearFiles()},addLc:function(){this.dataForm.bllc.push({lcmc:"",lcsj:"",lcms:""})},deleteLc:function(t,e){this.index=this.dataForm.bllc.indexOf(t),-1!==e&&this.dataForm.bllc.splice(e,1)}}},r={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{title:t.dataForm.id?"修改":"新增","close-on-click-modal":!1,visible:t.visible},on:{"update:visible":function(e){t.visible=e},close:t.closeDialog}},[a("el-form",{ref:"dataForm",attrs:{model:t.dataForm,rules:t.dataRule,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"受理时间",prop:"slsj"}},[a("el-input",{attrs:{placeholder:"格式（yyyy-MM-dd HH:mm:ss）"},model:{value:t.dataForm.slsj,callback:function(e){t.$set(t.dataForm,"slsj",e)},expression:"dataForm.slsj"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"诉求主题",prop:"sqzt"}},[a("el-input",{model:{value:t.dataForm.sqzt,callback:function(e){t.$set(t.dataForm,"sqzt",e)},expression:"dataForm.sqzt"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"诉求描述",prop:"sqms"}},[a("el-input",{attrs:{type:"textarea",rows:4},model:{value:t.dataForm.sqms,callback:function(e){t.$set(t.dataForm,"sqms",e)},expression:"dataForm.sqms"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"转办单位",prop:"zbdw"}},[a("el-input",{model:{value:t.dataForm.zbdw,callback:function(e){t.$set(t.dataForm,"zbdw",e)},expression:"dataForm.zbdw"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"办理情况",prop:"blqk"}},[a("el-input",{attrs:{type:"textarea",rows:4},model:{value:t.dataForm.blqk,callback:function(e){t.$set(t.dataForm,"blqk",e)},expression:"dataForm.blqk"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"办理流程",prop:"bllc"}},t._l(t.dataForm.bllc,function(e,s){return a("div",[a("el-row",[a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{prop:"bllc."+s+".lcmc",rules:t.bllcRules.lcmc}},[a("el-input",{staticStyle:{width:"150px"},attrs:{size:"small",placeholder:"流程名称"},model:{value:e.lcmc,callback:function(a){t.$set(e,"lcmc",a)},expression:"item.lcmc"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{prop:"bllc."+s+".lcsj",rules:t.bllcRules.lcsj}},[a("el-input",{staticStyle:{width:"150px"},attrs:{size:"small",placeholder:"流程时间"},model:{value:e.lcsj,callback:function(a){t.$set(e,"lcsj",a)},expression:"item.lcsj"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:11}},[a("el-form-item",{attrs:{prop:"bllc."+s+".lcms",rules:t.bllcRules.lcms}},[a("el-input",{staticStyle:{width:"280px"},attrs:{size:"small",placeholder:"流程描述"},model:{value:e.lcms,callback:function(a){t.$set(e,"lcms",a)},expression:"item.lcms"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:1}},[a("el-form-item",[s>0?a("i",{staticClass:"el-icon-remove-outline",on:{click:function(a){t.deleteLc(e,s)}}}):t._e(),t._v(" "),0==s?a("i",{staticClass:"el-icon-circle-plus-outline",on:{click:t.addLc}}):t._e()])],1)],1)],1)})),t._v(" "),a("el-form-item",{attrs:{label:"内容分类",prop:"nrfl"}},[a("el-input",{model:{value:t.dataForm.nrfl,callback:function(e){t.$set(t.dataForm,"nrfl",e)},expression:"dataForm.nrfl"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"区域",prop:"area"}},[a("el-input",{model:{value:t.dataForm.area,callback:function(e){t.$set(t.dataForm,"area",e)},expression:"dataForm.area"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"地址",prop:"address"}},[a("el-input",{model:{value:t.dataForm.address,callback:function(e){t.$set(t.dataForm,"address",e)},expression:"dataForm.address"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"文件名称",prop:"path"}},[a("el-input",{attrs:{readonly:"readonly"},model:{value:t.dataForm.path,callback:function(e){t.$set(t.dataForm,"path",e)},expression:"dataForm.path"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"录音播放",prop:"path"}},[a("audio",{ref:"audio",attrs:{controls:""}})]),t._v(" "),a("el-form-item",[a("el-upload",{ref:"upload",staticClass:"upload-audio",attrs:{action:t.fileUrl,limit:1,"before-upload":t.beforeAvatarUpload,"auto-upload":!1,"on-success":t.handleSuccess,name:"uploadAudio"}},[a("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[t._v("选取文件")]),t._v(" "),a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"small",type:"success"},on:{click:t.submitUpload}},[t._v("上传到服务器")])],1)],1)],1),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.visible=!1}}},[t._v("取消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.dataFormSubmit()}}},[t._v("确定")])],1)],1)},staticRenderFns:[]},i=a("46Yf")(l,r,!1,null,null,null);e.default=i.exports}});